<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/layout :: head">
</head>

<body>

	<nav th:replace="fragments/layout :: navigation"></nav>
	<div th:replace="fragments/layout :: app-instance"></div>

	<!--  PAGE BODY -->
	<span id="tutorialName" style="display: none;">bluegreen</span>

	<div class="container">

		<h2>Blue Green Deployment</h2>

		<div class="row">
			<div class="panel panel-default">
				<div class="panel-body">
					<div id="bluegreenBlock"></div>
				</div>
			</div>
			<div class="panel-footer clearfix">
				<div class="pull-right">
					<a href="javascript:startTimer();" class="btn btn-default">Start</a>
					<a href="javascript:stopTimer();" class="btn btn-default">Stop</a>
				</div>
			</div>
		</div>

		<div th:replace="fragments/layout :: tutorial"></div>

	</div>

	<script>
		var INTERVAL = 1000
		var timerID = 0;
		var versions = {};
		var startTime;

		function startTimer() {
			timerID = setInterval(startLoad, INTERVAL);
		}

		function stopTimer() {
			if (timerID)
				clearInterval(timerID);
		}

		function startLoad() {

			$
					.getJSON(
							'/health',
							function(health) {

								if (health.db.database in versions) {
									versions[health.db.database] = 1 + versions[health.db.database];
								} else {
									versions[health.db.database] = 1;
								}

								var html = '';
								for ( var version in versions) {
									html += '<p>' + version + '<b> = '
											+ versions[version] + '</b></p>'
								}

								$('#bluegreenBlock').html(html);
							});

		}
	</script>

	<!--  /.PAGE BODY -->

	<script th:replace="fragments/layout :: app-instance-script"></script>

</body>

</html>

